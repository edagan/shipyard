go_import_path: github.com/shipyard/shipyard
language: go
sudo: required
go:
  - 1.5
services:
  - docker
env:
  DOCKER_COMPOSE_VERSION: 1.6.0
  
global:
    - BRANCH=v1.10.3
    - DOCKER_STORAGE_DRIVER=aufs
    - UML_DOCKERCOMPOSE=0
before_install:
 #  install nodejs and bower
  - sudo bash < <(curl -s -S -L https://deb.nodesource.com/setup_5.x)
  - sudo apt-get -qq update
  - sudo apt-get install -y bash bison curl nodejs
  - sudo npm install bower -g
# install docker-compose
#  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
#  - sudo mv docker-compose /usr/local/bin
#  - sudo mv /etc/default/docker /etc/default/docker1 
#  - sudo chmod 775 /etc/apt/sources.list.d/docker.list 
#  - yes n|apt-get install -y docker-engine 
#  - sudo mv /etc/default/docker1 /etc/default/docker
#  - docker --version
# pull the rethinkdb 
#  - docker pull rethinkdb
#  - docker run -d -p 29015:29015 -p 28015:28015 -p 8087:8080 --name=rethinkdb --hostname=rethinkdb  -e no_proxy="localhost,127.0.0.1,proxy,swarm,media,rethinkdb" rethinkdb
install:
  - curl -sLo - http://j.mp/install-travis-docker | sh -xe
  - go get github.com/tools/godep
script:
  - if [[ $(go version |grep 1.5) ]]; then export GO15VENDOREXPERIMENT=1 ; fi
  - make all
  - ./run docker-compose -f docker-compose.yml up -d
#  - make test
  - ./run docker exec -it shipyard_controller_1 make test